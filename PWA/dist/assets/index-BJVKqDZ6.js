import{r as m,c as re,j as e,L as z,B as de,R as ge,a as J,b as ue}from"./vendor-DTC6a9R3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();let f,j=0,K=null;function q(){return(K===null||K.byteLength===0)&&(K=new Uint8Array(f.memory.buffer)),K}const V=new TextEncoder;"encodeInto"in V||(V.encodeInto=function(a,t){const r=V.encode(a);return t.set(r),{read:a.length,written:r.length}});function C(a,t,r){if(r===void 0){const c=V.encode(a),l=t(c.length,1)>>>0;return q().subarray(l,l+c.length).set(c),j=c.length,l}let s=a.length,n=t(s,1)>>>0;const o=q();let i=0;for(;i<s;i++){const c=a.charCodeAt(i);if(c>127)break;o[n+i]=c}if(i!==s){i!==0&&(a=a.slice(i)),n=r(n,s,s=i+a.length*3,1)>>>0;const c=q().subarray(n+i,n+s),l=V.encodeInto(a,c);i+=l.written,n=r(n,s,i,1)>>>0}return j=i,n}let B=null;function R(){return(B===null||B.buffer.detached===!0||B.buffer.detached===void 0&&B.buffer!==f.memory.buffer)&&(B=new DataView(f.memory.buffer)),B}function $(a){const t=f.__externref_table_alloc();return f.__wbindgen_export_4.set(t,a),t}function A(a,t){try{return a.apply(this,t)}catch(r){const s=$(r);f.__wbindgen_exn_store(s)}}let G=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});G.decode();const me=2146435072;let X=0;function he(a,t){return X+=t,X>=me&&(G=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),G.decode(),X=t),G.decode(q().subarray(a,a+t))}function T(a,t){return a=a>>>0,he(a,t)}function P(a){return a==null}function Z(a,t){return a=a>>>0,q().subarray(a/1,a/1+t)}function I(a){const t=f.__wbindgen_export_4.get(a);return f.__externref_table_dealloc(a),t}function fe(a,t){const r=t(a.length*4,4)>>>0;for(let s=0;s<a.length;s++){const n=$(a[s]);R().setUint32(r+4*s,n,!0)}return j=a.length,r}function xe(){const a=f.init_core();if(a[1])throw I(a[0])}const se=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>f.__wbg_snartnetcore_free(a>>>0,1));let te=class{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,se.unregister(this),t}free(){const t=this.__destroy_into_raw();f.__wbg_snartnetcore_free(t,0)}constructor(){const t=f.snartnetcore_new();return this.__wbg_ptr=t>>>0,se.register(this,this.__wbg_ptr,this),this}init(){const t=f.snartnetcore_init(this.__wbg_ptr);if(t[1])throw I(t[0])}create_profile(t,r,s){let n,o;try{const h=C(t,f.__wbindgen_malloc,f.__wbindgen_realloc),b=j;var i=P(r)?0:C(r,f.__wbindgen_malloc,f.__wbindgen_realloc),c=j,l=P(s)?0:C(s,f.__wbindgen_malloc,f.__wbindgen_realloc),d=j;const x=f.snartnetcore_create_profile(this.__wbg_ptr,h,b,i,c,l,d);var u=x[0],g=x[1];if(x[3])throw u=0,g=0,I(x[2]);return n=u,o=g,T(u,g)}finally{f.__wbindgen_free(n,o,1)}}get_current_profile(){const t=f.snartnetcore_get_current_profile(this.__wbg_ptr);if(t[2])throw I(t[1]);return I(t[0])}update_current_profile(t,r){var s=P(t)?0:C(t,f.__wbindgen_malloc,f.__wbindgen_realloc),n=j,o=P(r)?0:C(r,f.__wbindgen_malloc,f.__wbindgen_realloc),i=j;const c=f.snartnetcore_update_current_profile(this.__wbg_ptr,s,n,o,i);if(c[1])throw I(c[0])}create_post(t,r,s){const n=C(t,f.__wbindgen_malloc,f.__wbindgen_realloc),o=j;var i=P(r)?0:fe(r,f.__wbindgen_malloc),c=j,l=P(s)?0:C(s,f.__wbindgen_malloc,f.__wbindgen_realloc),d=j;const u=f.snartnetcore_create_post(this.__wbg_ptr,n,o,i,c,l,d);if(u[2])throw I(u[1]);return I(u[0])}create_message(t,r){const s=C(t,f.__wbindgen_malloc,f.__wbindgen_realloc),n=j,o=C(r,f.__wbindgen_malloc,f.__wbindgen_realloc),i=j,c=f.snartnetcore_create_message(this.__wbg_ptr,s,n,o,i);if(c[2])throw I(c[1]);return I(c[0])}get_public_key(){let t,r;try{const o=f.snartnetcore_get_public_key(this.__wbg_ptr);var s=o[0],n=o[1];if(o[3])throw s=0,n=0,I(o[2]);return t=s,r=n,T(s,n)}finally{f.__wbindgen_free(t,r,1)}}get_fingerprint(){let t,r;try{const o=f.snartnetcore_get_fingerprint(this.__wbg_ptr);var s=o[0],n=o[1];if(o[3])throw s=0,n=0,I(o[2]);return t=s,r=n,T(s,n)}finally{f.__wbindgen_free(t,r,1)}}has_profile(){return f.snartnetcore_has_profile(this.__wbg_ptr)!==0}};Symbol.dispose&&(te.prototype[Symbol.dispose]=te.prototype.free);const pe=new Set(["basic","cors","default"]);async function be(a,t){if(typeof Response=="function"&&a instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(a,t)}catch(s){if(a.ok&&pe.has(a.type)&&a.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const r=await a.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{const r=await WebAssembly.instantiate(a,t);return r instanceof WebAssembly.Instance?{instance:r,module:a}:r}}function ye(){const a={};return a.wbg={},a.wbg.__wbg_String_8f0eb39a4a4c2f66=function(t,r){const s=String(r),n=C(s,f.__wbindgen_malloc,f.__wbindgen_realloc),o=j;R().setInt32(t+4*1,o,!0),R().setInt32(t+4*0,n,!0)},a.wbg.__wbg_call_13410aac570ffff7=function(){return A(function(t,r){return t.call(r)},arguments)},a.wbg.__wbg_call_a5400b25a865cfd8=function(){return A(function(t,r,s){return t.call(r,s)},arguments)},a.wbg.__wbg_crypto_574e78ad8b13b65f=function(t){return t.crypto},a.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,r){let s,n;try{s=t,n=r,console.error(T(t,r))}finally{f.__wbindgen_free(s,n,1)}},a.wbg.__wbg_getItem_9fc74b31b896f95a=function(){return A(function(t,r,s,n){const o=r.getItem(T(s,n));var i=P(o)?0:C(o,f.__wbindgen_malloc,f.__wbindgen_realloc),c=j;R().setInt32(t+4*1,c,!0),R().setInt32(t+4*0,i,!0)},arguments)},a.wbg.__wbg_getRandomValues_38a1ff1ea09f6cc7=function(){return A(function(t,r){globalThis.crypto.getRandomValues(Z(t,r))},arguments)},a.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return A(function(t,r){t.getRandomValues(r)},arguments)},a.wbg.__wbg_getTime_6bb3f64e0f18f817=function(t){return t.getTime()},a.wbg.__wbg_instanceof_Window_12d20d558ef92592=function(t){let r;try{r=t instanceof Window}catch{r=!1}return r},a.wbg.__wbg_length_6bb7e81f9d7713e4=function(t){return t.length},a.wbg.__wbg_localStorage_9330af8bf39365ba=function(){return A(function(t){const r=t.localStorage;return P(r)?0:$(r)},arguments)},a.wbg.__wbg_log_6c7b5f4f00b8ce3f=function(t){console.log(t)},a.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(t){return t.msCrypto},a.wbg.__wbg_new0_b0a0a38c201e6df5=function(){return new Date},a.wbg.__wbg_new_19c25a3f2fa63a02=function(){return new Object},a.wbg.__wbg_new_1f3a344cf3123716=function(){return new Array},a.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},a.wbg.__wbg_newnoargs_254190557c45b4ec=function(t,r){return new Function(T(t,r))},a.wbg.__wbg_newwithlength_a167dcc7aaa3ba77=function(t){return new Uint8Array(t>>>0)},a.wbg.__wbg_node_905d3e251edff8a2=function(t){return t.node},a.wbg.__wbg_process_dc0fbacc7c1c06f7=function(t){return t.process},a.wbg.__wbg_prototypesetcall_3d4a26c1ed734349=function(t,r,s){Uint8Array.prototype.set.call(Z(t,r),s)},a.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return A(function(t,r){t.randomFillSync(r)},arguments)},a.wbg.__wbg_removeItem_487c5a070c7adaf7=function(){return A(function(t,r,s){t.removeItem(T(r,s))},arguments)},a.wbg.__wbg_require_60cc747a6bc5215a=function(){return A(function(){return module.require},arguments)},a.wbg.__wbg_setItem_7add5eb06a28b38f=function(){return A(function(t,r,s,n,o){t.setItem(T(r,s),T(n,o))},arguments)},a.wbg.__wbg_set_3f1d0b984ed272ed=function(t,r,s){t[r]=s},a.wbg.__wbg_set_90f6c0f7bd8c0415=function(t,r,s){t[r>>>0]=s},a.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,r){const s=r.stack,n=C(s,f.__wbindgen_malloc,f.__wbindgen_realloc),o=j;R().setInt32(t+4*1,o,!0),R().setInt32(t+4*0,n,!0)},a.wbg.__wbg_static_accessor_GLOBAL_8921f820c2ce3f12=function(){const t=typeof globalThis>"u"?null:globalThis;return P(t)?0:$(t)},a.wbg.__wbg_static_accessor_GLOBAL_THIS_f0a4409105898184=function(){const t=typeof globalThis>"u"?null:globalThis;return P(t)?0:$(t)},a.wbg.__wbg_static_accessor_SELF_995b214ae681ff99=function(){const t=typeof self>"u"?null:self;return P(t)?0:$(t)},a.wbg.__wbg_static_accessor_WINDOW_cde3890479c675ea=function(){const t=typeof window>"u"?null:window;return P(t)?0:$(t)},a.wbg.__wbg_subarray_70fd07feefe14294=function(t,r,s){return t.subarray(r>>>0,s>>>0)},a.wbg.__wbg_versions_c01dfd4722a88165=function(t){return t.versions},a.wbg.__wbg_wbindgenisfunction_8cee7dce3725ae74=function(t){return typeof t=="function"},a.wbg.__wbg_wbindgenisobject_307a53c6bd97fbf8=function(t){const r=t;return typeof r=="object"&&r!==null},a.wbg.__wbg_wbindgenisstring_d4fa939789f003b0=function(t){return typeof t=="string"},a.wbg.__wbg_wbindgenisundefined_c4b71d073b92f3c5=function(t){return t===void 0},a.wbg.__wbg_wbindgenstringget_0f16a6ddddef376f=function(t,r){const s=r,n=typeof s=="string"?s:void 0;var o=P(n)?0:C(n,f.__wbindgen_malloc,f.__wbindgen_realloc),i=j;R().setInt32(t+4*1,i,!0),R().setInt32(t+4*0,o,!0)},a.wbg.__wbg_wbindgenthrow_451ec1a8469d7eb6=function(t,r){throw new Error(T(t,r))},a.wbg.__wbindgen_cast_2241b6af4c4b2941=function(t,r){return T(t,r)},a.wbg.__wbindgen_cast_cb9088102bce6b30=function(t,r){return Z(t,r)},a.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(t){return t},a.wbg.__wbindgen_init_externref_table=function(){const t=f.__wbindgen_export_4,r=t.grow(4);t.set(0,void 0),t.set(r+0,void 0),t.set(r+1,null),t.set(r+2,!0),t.set(r+3,!1)},a}function we(a,t){return f=a.exports,oe.__wbindgen_wasm_module=t,B=null,K=null,f.__wbindgen_start(),f}async function oe(a){if(f!==void 0)return f;typeof a<"u"&&(Object.getPrototypeOf(a)===Object.prototype?{module_or_path:a}=a:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof a>"u"&&(a=new URL("/net/assets/snartnet_core_bg-CgG932GT.wasm",import.meta.url));const t=ye();(typeof a=="string"||typeof Request=="function"&&a instanceof Request||typeof URL=="function"&&a instanceof URL)&&(a=fetch(a));const{instance:r,module:s}=await be(await a,t);return we(r,s)}class ve{client=null;activeTorrents=new Map;eventCallbacks=[];readyPromise;resolveReady;clientReady=!1;pendingSeeds=[];stats={torrents:0,downloadSpeed:0,uploadSpeed:0,downloaded:0,uploaded:0,peers:0};constructor(){this.readyPromise=new Promise(t=>{this.resolveReady=t}),this.initializeClient()}async initializeClient(){if(typeof window>"u")return;let t=0;const r=10,s=()=>{t++;const n=window.WebTorrent;if(!n||typeof n!="function")if(t<r){console.warn(`[TorrentService] WebTorrent not available yet (attempt ${t}), retrying...`),setTimeout(s,500);return}else{const o=new Error("WebTorrent not available after retries");console.error("[TorrentService] ",o),this.emitEvent({type:"error",error:o.message});return}try{this.client=new n,this.clientReady=!0,this.client.on("error",i=>{console.error("[TorrentService] Client error:",i),this.emitEvent({type:"error",error:i.message})}),this.client.on("torrent",i=>{console.log("[TorrentService] Torrent added:",{name:i.name,infoHash:i.infoHash}),this.activeTorrents.set(i.infoHash,i),this.emitEvent({type:"torrent-added",torrent:i}),this.updateStats()}),console.log("[TorrentService] WebTorrent client initialized successfully"),this.resolveReady();const o=[...this.pendingSeeds];this.pendingSeeds=[],o.forEach(i=>{try{i()}catch(c){console.error("[TorrentService] Pending seed failed:",c)}})}catch(o){console.error("[TorrentService] Failed to initialize:",o),this.emitEvent({type:"error",error:String(o)})}};s()}emitEvent(t){this.eventCallbacks.forEach(r=>{try{r(t)}catch(s){console.error("Error in event callback:",s)}})}updateStats(){if(this.client)try{this.stats={torrents:this.client.torrents.length,downloadSpeed:this.client.downloadSpeed||0,uploadSpeed:this.client.uploadSpeed||0,downloaded:this.client.downloaded||0,uploaded:this.client.uploaded||0,peers:this.client.torrents.reduce((t,r)=>t+(r.numPeers||0),0)}}catch(t){console.error("Error updating stats:",t)}}async seedProfile(t){if(await this.readyPromise,!this.client)throw new Error("WebTorrent client not initialized. Are you in a browser environment?");try{const r=JSON.stringify(t,null,2),s=`${t.username}_profile.json`,o=new TextEncoder().encode(r),i=new File([o],s,{type:"application/json; charset=utf-8"});return new Promise((c,l)=>{const d=setTimeout(()=>{l(new Error("Seeding timeout"))},1e4);try{console.log("Seeding profile file:",{fileName:s,fileSize:i.size,fileType:i.type,profileDataLength:r.length});const u=this.client.seed([i],g=>{clearTimeout(d),console.log("Profile seeded successfully:",g.magnetURI),this.emitEvent({type:"seeding-started",profile:t,magnetURI:g.magnetURI}),c(g.magnetURI)});u.on("error",g=>{clearTimeout(d),this.emitEvent({type:"error",error:g.message}),l(g)}),u.on("wire",g=>{this.emitEvent({type:"peer-connected",peerId:g.peerId||"unknown"})}),u.on("upload",()=>{this.emitEvent({type:"upload-progress",uploadSpeed:u.uploadSpeed||0}),this.updateStats()})}catch(u){clearTimeout(d),l(u)}})}catch(r){throw console.error("Error seeding profile:",r),r}}ensureReadyAction(t){this.clientReady?t():(console.log("[TorrentService] Client not ready, queuing action"),this.pendingSeeds.push(t))}async seedPost(t){if(await this.readyPromise,!this.client||!this.clientReady)throw new Error("WebTorrent client not ready for seeding");const r=performance.now();console.log("[TorrentService] Seeding post start",{author:t.author,hasImages:!!t.images?.length});const s=JSON.stringify(t,null,2),n=`post_${Date.now()}.json`,o=new TextEncoder().encode(s),i=new File([o],n,{type:"application/json; charset=utf-8"});return new Promise((c,l)=>{let d=!1;const u=()=>{try{const g=this.client.seed([i],h=>{d=!0;const b=(performance.now()-r).toFixed(0);console.log("[TorrentService] Post torrent ready",{infoHash:h.infoHash,magnet:h.magnetURI,durationMs:b}),this.emitEvent({type:"seeding-started",post:t,magnetURI:h.magnetURI}),c(h.magnetURI)});g.on("error",h=>{d?console.warn("[TorrentService] Torrent error after ready:",h):(console.error("[TorrentService] Torrent error before ready:",h),l(h))}),g.on("wire",h=>{this.emitEvent({type:"peer-connected",peerId:h.peerId||"unknown"})})}catch(g){console.error("[TorrentService] Seed action failed synchronously:",g),l(g)}};this.ensureReadyAction(u),setTimeout(()=>{d||l(new Error("Seeding post timed out"))},15e3)})}async downloadProfile(t){if(await this.readyPromise,!this.client)throw new Error("WebTorrent client not initialized. Are you in a browser environment?");try{return new Promise((r,s)=>{const n=setTimeout(()=>{s(new Error("Download timeout - no peers found"))},3e4);try{const o=this.client.add(t,i=>{console.log("Started downloading torrent:",i.name||"unnamed")});o.on("done",()=>{clearTimeout(n);const i=o.files.find(c=>c.name&&c.name.endsWith("_profile.json"));if(i)i.getBuffer((c,l)=>{if(c){this.emitEvent({type:"error",error:c.message}),s(c);return}try{let d;if(l instanceof ArrayBuffer){const g=new Uint8Array(l);d=new TextDecoder("utf-8",{fatal:!1}).decode(g)}else l&&typeof l.toString=="function"?d=l.toString("utf8"):d=String(l);const u=JSON.parse(d);this.emitEvent({type:"profile-downloaded",profile:u}),r(u)}catch(d){console.error("Profile parsing error:",d),console.error("Buffer type:",typeof l),console.error("Buffer constructor:",l?.constructor?.name),this.emitEvent({type:"error",error:`Failed to parse profile data: ${d instanceof Error?d.message:"Unknown error"}`}),s(d)}});else{const c="Profile file not found in torrent";this.emitEvent({type:"error",error:c}),s(new Error(c))}}),o.on("download",()=>{this.emitEvent({type:"download-progress",progress:o.progress||0,downloadSpeed:o.downloadSpeed||0}),this.updateStats()}),o.on("error",i=>{clearTimeout(n),this.emitEvent({type:"error",error:i.message}),s(i)})}catch(o){clearTimeout(n),s(o)}})}catch(r){throw console.error("Error downloading profile:",r),r}}getStats(){return this.updateStats(),{...this.stats}}getActiveTorrents(){if(!this.client)return[];try{return this.client.torrents.map(t=>({infoHash:t.infoHash||"",name:t.name||"Unnamed Torrent",magnetURI:t.magnetURI||"",progress:t.progress||0,downloadSpeed:t.downloadSpeed||0,uploadSpeed:t.uploadSpeed||0,numPeers:t.numPeers||0,downloaded:t.downloaded||0,uploaded:t.uploaded||0}))}catch(t){return console.error("Error getting active torrents:",t),[]}}onEvent(t){return this.eventCallbacks.push(t),()=>{const r=this.eventCallbacks.indexOf(t);r>-1&&this.eventCallbacks.splice(r,1)}}stopSeeding(t){if(!this.client)return!1;try{const r=this.client.get(t);return r?(this.client.remove(r),this.activeTorrents.delete(t),this.updateStats(),!0):!1}catch(r){return console.error("Error stopping torrent seeding:",r),!1}}destroy(){try{this.client&&typeof this.client.destroy=="function"&&this.client.destroy()}catch(t){console.error("Error destroying torrent client:",t)}}}let Q=null;function M(){return Q||(Q=new ve),Q}function O(a){return a?{id:a.id,username:a.username,displayName:a.display_name||a.displayName||void 0,bio:a.bio||void 0,avatarHash:a.avatar_hash||a.avatarHash||void 0,publicKey:a.public_key||a.publicKey,fingerprint:a.fingerprint,createdAt:typeof a.created_at=="string"?a.created_at:a.createdAt,updatedAt:typeof a.updated_at=="string"?a.updated_at:a.updatedAt,version:a.version||1,magnetUri:a.magnet_uri||a.magnetUri||void 0,schemaVersion:1}:null}class ke{wasmCore;eventCallbacks=new Set;capabilities=null;constructor(t){this.wasmCore=t}async init(){try{await this.wasmCore.init(),console.log("[SnartNetCore] WASM core initialized")}catch(t){throw console.error("[SnartNetCore] Init error:",t),t}}async getCapabilities(){if(this.capabilities)return this.capabilities;let t={profileJsonApi:!1,postJsonApi:!1,messageJsonApi:!1,version:"0"};const r=this.wasmCore.get_capabilities;if(typeof r=="function")try{const s=r.call(this.wasmCore);if(s){let n=s;if(typeof s=="string")try{n=JSON.parse(s)}catch{}t={profileJsonApi:!!(n.profileJsonApi||n.profile_json_api),postJsonApi:!!(n.postJsonApi||n.post_json_api),messageJsonApi:!!(n.messageJsonApi||n.message_json_api),version:n.version?String(n.version):"0"}}}catch(s){console.warn("[Core] capability probe failed, using defaults",s)}return this.capabilities=t,t}async createProfile(t,r,s){if((await this.getCapabilities()).profileJsonApi&&this.wasmCore.create_profile_json){const o=JSON.stringify({username:t,displayName:r||null,bio:s||null}),i=this.wasmCore.create_profile_json(o),c=typeof i=="string"?JSON.parse(i):i,l=c.profile||c.profileJson||c,d=O(l);return d&&this.emitEvent({type:"ProfileLoaded",profile:d}),c.magnetUri||l.magnetUri||""}try{const o=this.wasmCore.create_profile(t,r||void 0,s||void 0),i=this.wasmCore.get_current_profile(),c=O(i);return c&&this.emitEvent({type:"ProfileLoaded",profile:c}),o}catch(o){const i=String(o?.message||o);console.error("[Core] legacy create_profile failed:",o);const c=this.wasmCore.create_profile_json;if(c)try{const l=JSON.stringify({username:t,displayName:r||null,bio:s||null}),d=c(l),u=typeof d=="string"?JSON.parse(d):d,g=u.profile||u.profileJson||u,h=O(g);return h&&this.emitEvent({type:"ProfileLoaded",profile:h}),u.magnetUri||g.magnetUri||""}catch(l){console.error("[Core] JSON fallback also failed:",l)}if(/memory access out of bounds/i.test(i)){console.warn("[Core] Detected possible corrupted WASM state; clearing persisted key/profile entries");try{localStorage.removeItem("snartnet_keypair"),localStorage.removeItem("snartnet_current_profile")}catch{}}throw o}}async getCurrentProfile(){if((await this.getCapabilities()).profileJsonApi&&this.wasmCore.get_current_profile_json){const s=this.wasmCore.get_current_profile_json();if(!s)return null;const n=typeof s=="string"?JSON.parse(s):s,o=n.profile||n.profileJson||n;return O(o)}const r=this.wasmCore.get_current_profile();return O(r)}async updateProfile(t,r){if((await this.getCapabilities()).profileJsonApi&&this.wasmCore.update_profile_json){const i=JSON.stringify({displayName:t||null,bio:r||null}),c=this.wasmCore.update_profile_json(i),l=typeof c=="string"?JSON.parse(c):c,d=l.profile||l.profileJson||l,u=O(d);u&&this.emitEvent({type:"ProfileUpdated",profile:u});return}await this.wasmCore.update_current_profile(t||void 0,r||void 0);const n=this.wasmCore.get_current_profile(),o=O(n);o&&this.emitEvent({type:"ProfileUpdated",profile:o})}async getPublicKey(){try{return this.wasmCore.get_public_key()}catch(t){throw console.error("[SnartNetCore] Get public key error:",t),t}}async getFingerprint(){try{return this.wasmCore.get_fingerprint()}catch(t){throw console.error("[SnartNetCore] Get fingerprint error:",t),t}}async createPost(t,r,s){try{const n=this.wasmCore.create_post(t,r||null,s||null);return console.log("[SnartNetCore] Post created:",n),this.emitEvent({type:"PostAdded",post:n}),n}catch(n){throw console.error("[SnartNetCore] Create post error:",n),n}}async createMessage(t,r){try{const s=this.wasmCore.create_message(t,r);return console.log("[SnartNetCore] Message created:",s),this.emitEvent({type:"MessageReceived",message:s}),s}catch(s){throw console.error("[SnartNetCore] Create message error:",s),s}}hasProfile(){return this.wasmCore.has_profile()}subscribeToEvents(t){return this.eventCallbacks.add(t),()=>this.eventCallbacks.delete(t)}emitEvent(t){this.eventCallbacks.forEach(r=>{try{r(t)}catch(s){console.error("[SnartNetCore] Error in event callback:",s)}})}async seedCurrentProfile(){try{const t=this.wasmCore.get_current_profile();if(!t)throw new Error("No current profile to seed");console.log("[SnartNetCore] Profile data type:",typeof t),console.log("[SnartNetCore] Profile data:",t);let r;typeof t=="object"&&t!==null?r=JSON.parse(JSON.stringify(t)):r=t,console.log("[SnartNetCore] Clean profile:",r);const n=await M().seedProfile(r);return console.log("[SnartNetCore] Profile seeding started:",n),n}catch(t){throw console.error("[SnartNetCore] Failed to seed profile:",t),t}}async downloadProfileFromMagnet(t){try{const s=await M().downloadProfile(t);return console.log("[SnartNetCore] Profile downloaded:",s),s}catch(r){throw console.error("[SnartNetCore] Failed to download profile:",r),r}}getTorrentStats(){return M().getStats()}getActiveTorrents(){return M().getActiveTorrents()}async stopSeeding(t){M().stopSeeding(t)}async getTimeline(){return[{id:"post_1",content:"Welcome to SnartNet! This is a decentralized social media platform.",author:"alice",timestamp:new Date(Date.now()-36e5).toISOString(),tags:["introduction","snartnet"]},{id:"post_2",content:"Just created my first cryptographically signed post! 🔐",author:"bob",timestamp:new Date(Date.now()-18e5).toISOString(),tags:["crypto","security"]}]}validateProfile(t){if(!t||typeof t!="object")return!1;for(const r of["id","username","publicKey","fingerprint","createdAt","updatedAt"])if(!(r in t))return!1;return!0}validatePost(t){return!!t&&typeof t=="object"&&"id"in t&&"author"in t}}let Y=null;async function W(){if(!Y)try{await oe(),await xe();const a=new te;Y=new ke(a),await Y.init(),console.log("[Core] Initialized successfully")}catch(a){throw console.error("[Core] Initialization failed:",a),a}return Y}function je(){const[a,t]=m.useState(null),[r,s]=m.useState(!0);return m.useEffect(()=>{W().then(n=>{t(n),s(!1)}).catch(n=>{console.error("Failed to initialize core:",n),s(!1)})},[]),{core:a,loading:r}}const U=re(a=>({currentProfile:null,profiles:new Map,loading:!1,error:null,setCurrentProfile:t=>a({currentProfile:t}),addProfile:t=>a(r=>{const s=new Map(r.profiles);return s.set(t.username,t),{profiles:s}}),updateProfile:(t,r)=>a(s=>{const n=new Map(s.profiles),o=n.get(t);o&&n.set(t,{...o,...r});let i=s.currentProfile;return s.currentProfile?.username===t&&(i={...s.currentProfile,...r}),{profiles:n,currentProfile:i}}),updateProfilePicture:(t,r,s)=>a(n=>{const o={profilePicture:r,profilePictureThumbnail:s||r,updatedAt:new Date().toISOString()},i=new Map(n.profiles),c=i.get(t);c&&i.set(t,{...c,...o});let l=n.currentProfile;return n.currentProfile?.username===t&&(l={...n.currentProfile,...o},localStorage.setItem(`profile-picture-${t}`,r),s&&localStorage.setItem(`profile-picture-thumb-${t}`,s)),{profiles:i,currentProfile:l}}),addProfilePost:(t,r)=>a(s=>{const n=new Map(s.profiles),o=n.get(t),i={id:Math.random().toString(36).slice(2),content:r,createdAt:new Date().toISOString()};if(o){const l=o.posts?[i,...o.posts]:[i];n.set(t,{...o,posts:l})}let c=s.currentProfile;if(s.currentProfile?.username===t){const l=s.currentProfile.posts?[i,...s.currentProfile.posts]:[i];c={...s.currentProfile,posts:l}}return{profiles:n,currentProfile:c}}),removeProfilePost:(t,r)=>a(s=>{const n=new Map(s.profiles),o=n.get(t);if(o&&o.posts){const c=o.posts.filter(l=>l.id!==r);n.set(t,{...o,posts:c})}let i=s.currentProfile;if(s.currentProfile?.username===t&&s.currentProfile.posts){const c=s.currentProfile.posts.filter(l=>l.id!==r);i={...s.currentProfile,posts:c}}return{profiles:n,currentProfile:i}}),setLoading:t=>a({loading:t}),setError:t=>a({error:t}),clearError:()=>a({error:null})}));function Ne(a){return a?{id:a.id||a.postId||Math.random().toString(36).slice(2),author:a.author||a.author_fingerprint||a.fingerprint||"unknown",authorDisplayName:a.authorDisplayName||a.author_display_name||a.displayName,authorAvatar:a.authorAvatar||a.author_avatar,content:a.content||"",images:a.images,magnetUri:a.magnetUri||a.magnet_uri,createdAt:a.createdAt||a.created_at||new Date().toISOString(),updatedAt:a.updatedAt||a.updated_at,tags:a.tags,version:a.version||1,schemaVersion:1}:null}const ie=re(a=>({posts:[],loading:!1,error:null,addPost:async t=>{const r={...t,id:Math.random().toString(36).slice(2),createdAt:new Date().toISOString(),version:1},s=Ne(r);a(n=>({posts:[s,...n.posts].sort((o,i)=>new Date(i.createdAt).getTime()-new Date(o.createdAt).getTime())}));try{const o=await M().seedPost(t);a(i=>({posts:i.posts.map(c=>c.id===s.id?{...c,magnetUri:o,seedProgress:100,isSeeding:!1}:c)}))}catch(n){console.error("Failed to seed post:",n),a(o=>({posts:o.posts.map(i=>i.id===s.id?{...i,isSeeding:!1,seedProgress:0,seedError:n instanceof Error?n.message:"Failed to seed"}:i)}))}},removePost:t=>{a(r=>({posts:r.posts.filter(s=>s.id!==t)}))},updatePost:(t,r)=>{a(s=>({posts:s.posts.map(n=>n.id===t?{...n,...r}:n)}))},updateSeedingStatus:(t,r,s)=>{a(n=>({posts:n.posts.map(o=>o.id===t?{...o,isSeeding:r,seedProgress:s}:o)}))},loadPostsFromContacts:async()=>{a({loading:!0});try{await new Promise(t=>setTimeout(t,1e3)),a({loading:!1})}catch(t){a({loading:!1,error:t instanceof Error?t.message:"Failed to load posts"})}},setLoading:t=>a({loading:t}),setError:t=>a({error:t}),clearError:()=>a({error:null})}));class E{static PROFILE_SIZE=200;static THUMBNAIL_SIZE=64;static MAX_FILE_SIZE=2*1024*1024;static SUPPORTED_FORMATS=["image/jpeg","image/png","image/webp"];static OUTPUT_FORMAT="image/jpeg";static OUTPUT_QUALITY=.85;static async processProfilePicture(t){this.validateFile(t);const r=await this.loadImage(t),s=this.calculateSquareCrop(r.width,r.height);return await this.resizeAndCompress(r,s,this.PROFILE_SIZE)}static async createThumbnail(t){const r=await this.loadImageFromDataUrl(t.dataUrl),s={x:0,y:0,width:r.width,height:r.height};return this.resizeAndCompress(r,s,this.THUMBNAIL_SIZE)}static async processWithCrop(t,r){this.validateFile(t);const s=await this.loadImage(t);return this.resizeAndCompress(s,r,this.PROFILE_SIZE)}static validateFile(t){if(!this.SUPPORTED_FORMATS.includes(t.type))throw new Error(`Unsupported file format. Please use: ${this.SUPPORTED_FORMATS.join(", ")}`);if(t.size>this.MAX_FILE_SIZE)throw new Error(`File too large. Maximum size: ${Math.round(this.MAX_FILE_SIZE/1024/1024)}MB`)}static loadImage(t){return new Promise((r,s)=>{const n=new Image,o=URL.createObjectURL(t);n.onload=()=>{URL.revokeObjectURL(o),r(n)},n.onerror=()=>{URL.revokeObjectURL(o),s(new Error("Failed to load image"))},n.src=o})}static loadImageFromDataUrl(t){return new Promise((r,s)=>{const n=new Image;n.onload=()=>r(n),n.onerror=()=>s(new Error("Failed to load image from data URL")),n.src=t})}static calculateSquareCrop(t,r){const s=Math.min(t,r),n=(t-s)/2,o=(r-s)/2;return{x:n,y:o,width:s,height:s}}static async resizeAndCompress(t,r,s){const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Canvas context not available");n.width=s,n.height=s,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(t,r.x,r.y,r.width,r.height,0,0,s,s);const i=await new Promise((l,d)=>{n.toBlob(u=>{u?l(u):d(new Error("Failed to create blob"))},this.OUTPUT_FORMAT,this.OUTPUT_QUALITY)});return{dataUrl:n.toDataURL(this.OUTPUT_FORMAT,this.OUTPUT_QUALITY),blob:i,width:s,height:s,size:i.size,format:this.OUTPUT_FORMAT}}static async blobToBase64(t){return new Promise((r,s)=>{const n=new FileReader;n.onload=()=>{const i=n.result.split(",")[1];r(i)},n.onerror=()=>s(new Error("Failed to convert blob to base64")),n.readAsDataURL(t)})}static base64ToDataUrl(t,r=this.OUTPUT_FORMAT){return`data:${r};base64,${t}`}static formatFileSize(t){if(t===0)return"0 B";const r=1024,s=["B","KB","MB"],n=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,n)).toFixed(1))+" "+s[n]}static validateImageDimensions(t,r){if(t<100||r<100)throw new Error("Image too small. Minimum size: 100x100px");if(t>4e3||r>4e3)throw new Error("Image too large. Maximum size: 4000x4000px")}static generateAvatarInitials(t){return t.split(" ").map(r=>r.charAt(0).toUpperCase()).join("").substring(0,2)}static generateAvatarGradient(t){let r=0;for(let o=0;o<t.length;o++){const i=t.charCodeAt(o);r=(r<<5)-r+i,r=r&r}const s=Math.abs(r%360),n=(s+60)%360;return`linear-gradient(135deg, hsl(${s}, 70%, 50%), hsl(${n}, 70%, 70%))`}}async function _e(a,t){return a.type.startsWith("image/")?new Promise((r,s)=>{const n=new FileReader;n.onload=o=>{const i=o.target?.result;i?r({id:`${a.name}-${a.lastModified}`,data:i,filename:a.name,size:a.size,mimeType:a.type}):s(new Error("Failed to read file data."))},n.onerror=o=>{s(o)},n.readAsDataURL(a)}):(console.warn(`File is not an image: ${a.name}`),null)}function Se(){const[a,t]=m.useState(""),[r,s]=m.useState([]),[n,o]=m.useState(!1),{currentProfile:i}=U(),c=ie(h=>h.addPost),l=m.useRef(null),d=async h=>{if(h.target.files){const b=Array.from(h.target.files);try{const x=await Promise.all(b.map(y=>_e(y,"post-image")));s(y=>[...y,...x.filter(p=>p!==null)])}catch(x){console.error("Error processing images:",x)}}},u=h=>{s(b=>b.filter(x=>x.id!==h))},g=async h=>{if(h.preventDefault(),!(!a.trim()&&r.length===0||!i)){o(!0);try{const b=i.publicKey||i.username;await c({author:b,authorDisplayName:i.displayName||i.username,authorAvatar:i.avatar,content:a,images:r}),console.log("Post created and seeding process initiated."),t(""),s([])}catch(b){console.error("Failed to create post:",b)}finally{o(!1)}}};return i?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Create New Post"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("textarea",{value:a,onChange:h=>t(h.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"What's happening on the swarm?",disabled:n}),r.length>0&&e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4",children:r.map(h=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:h.data,alt:"Post attachment",className:"w-full h-24 object-cover rounded-md"}),e.jsx("button",{type:"button",onClick:()=>u(h.id),className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:"✕"})]},h.id))}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>l.current?.click(),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"Add image",disabled:n,children:e.jsx("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("input",{type:"file",ref:l,onChange:d,className:"hidden",accept:"image/*",multiple:!0,disabled:n,"aria-label":"File uploader"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Posts are seeded as torrents"})]}),e.jsx("button",{type:"submit",disabled:n||!a.trim()&&r.length===0,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors",children:n?"🌱 Seeding...":"🌱 Seed Post"})]})]})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300",children:"You need to create a profile before you can make posts."})})}const Ce=a=>{switch(a){case"ring-of-trust":return{canMessage:!0,canSeeFullProfile:!0,canShareContacts:!0,canRecoverKeys:!0};case"friend":return{canMessage:!0,canSeeFullProfile:!0,canShareContacts:!0,canRecoverKeys:!1};case"acquaintance":return{canMessage:!0,canSeeFullProfile:!1,canShareContacts:!1,canRecoverKeys:!1};case"group-member":return{canMessage:!0,canSeeFullProfile:!1,canShareContacts:!1,canRecoverKeys:!1}}},Pe=(a,t)=>`contact_${btoa(a+t).slice(0,16)}`,ae=re((a,t)=>({contacts:[],loadContacts:()=>{try{const r=localStorage.getItem("snartnet-contacts");if(r){const s=JSON.parse(r);a({contacts:s})}}catch(r){console.error("Failed to load contacts:",r)}},addContact:r=>{const s=t().contacts,n={...r,id:Pe(r.username,r.magnetUri),addedDate:new Date().toISOString(),permissions:Ce(r.relationship)},o=s.findIndex(i=>i.id===n.id);if(o>=0){const i=[...s];i[o]={...i[o],...n},a({contacts:i}),localStorage.setItem("snartnet-contacts",JSON.stringify(i))}else{const i=[...s,n];a({contacts:i}),localStorage.setItem("snartnet-contacts",JSON.stringify(i))}},removeContact:r=>{const n=t().contacts.filter(o=>o.id!==r);a({contacts:n}),localStorage.setItem("snartnet-contacts",JSON.stringify(n))},updateContact:(r,s)=>{const o=t().contacts.map(i=>i.id===r?{...i,...s}:i);a({contacts:o}),localStorage.setItem("snartnet-contacts",JSON.stringify(o))},getContactsByRelationship:r=>t().contacts.filter(s=>s.relationship===r),getContact:r=>t().contacts.find(s=>s.id===r)})),Ie=()=>{const{posts:a,loading:t,loadPostsFromContacts:r}=ie(),{loadContacts:s}=ae();return m.useEffect(()=>{s(),r()},[s,r]),t?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading timeline..."})]}):e.jsx("div",{className:"space-y-6",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🌱"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Be the first to seed a post on the swarm!"})]}):a.map(n=>e.jsx(Ee,{post:n},n.id))})},Ee=({post:a})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold",children:a.authorAvatar?e.jsx("img",{src:E.base64ToDataUrl(a.authorAvatar),alt:a.author,className:"w-10 h-10 rounded-full object-cover"}):a.author.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:a.authorDisplayName||a.author}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["@",a.author]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:Te(a.createdAt)}),a.isSeeding&&e.jsxs("span",{className:"flex items-center text-green-600 dark:text-green-400",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-1"}),"Seeding"]}),a.magnetUri&&e.jsx("span",{className:"flex items-center text-blue-600 dark:text-blue-400",children:"🧲 Torrent"})]})]})]}),a.content&&e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-gray-900 dark:text-gray-100 whitespace-pre-line",children:a.content})}),a.images&&a.images.length>0&&e.jsx("div",{className:`mb-4 grid gap-2 ${a.images.length===1?"grid-cols-1":(a.images.length===2||a.images.length===3,"grid-cols-2")}`,children:a.images.map((t,r)=>e.jsx("div",{className:`${a.images.length===3&&r===0?"col-span-2":""}`,children:e.jsx("img",{src:E.base64ToDataUrl(t.data),alt:t.filename,className:"w-full h-64 object-cover rounded-lg border border-gray-200 dark:border-gray-600 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{window.open(E.base64ToDataUrl(t.data),"_blank")}})},t.id))}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(t=>e.jsxs("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full",children:["#",t]},t))})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{className:"flex items-center space-x-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),e.jsx("span",{className:"text-sm",children:"Like"})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("span",{className:"text-sm",children:"Reply"})]}),e.jsxs("button",{className:"flex items-center space-x-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),e.jsx("span",{className:"text-sm",children:"Share"})]})]}),a.magnetUri&&e.jsx("button",{onClick:()=>navigator.clipboard.writeText(a.magnetUri),className:"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",title:"Copy magnet link",children:"🧲 Copy Magnet"})]})]}),Te=a=>{const t=new Date(a),s=Math.floor((new Date().getTime()-t.getTime())/1e3);return s<60?"just now":s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:s<604800?`${Math.floor(s/86400)}d ago`:t.toLocaleDateString()},Ae=()=>{const{core:a,loading:t}=je(),{currentProfile:r}=U(),[s,n]=m.useState(!0);return m.useEffect(()=>{a&&n(!1)},[a]),t||s?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Loading SnartNet..."})}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"SnartNet"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8",children:"Decentralized social media, powered by swarms."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[r&&e.jsx(Se,{}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx("span",{children:"Timeline"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:"(Torrent-seeded posts)"})]}),e.jsx(Ie,{})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"How It Works"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Every post is a torrent seed! Your content is distributed across the swarm, making it censorship-resistant and decentralized."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"🌱 Posts are seeded as torrents"}),e.jsx("p",{className:"text-sm text-gray-500",children:"📷 Images included in torrent files"}),e.jsx("p",{className:"text-sm text-gray-500",children:"🔐 Content cryptographically signed"}),e.jsx("p",{className:"text-sm text-gray-500",children:"🤝 Shared through your Ring of Trust"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Features"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{children:"Profile pictures & posts"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{children:"Image upload & processing"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{children:"Post torrent seeding"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{children:"Chronological timeline"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full mr-2"}),e.jsx("span",{children:"P2P post sharing (WIP)"})]})]})]})]})]})]})};function ne(){const[a,t]=m.useState(""),[r,s]=m.useState(""),[n,o]=m.useState(""),[i,c]=m.useState(!1),[l,d]=m.useState(null),[u,g]=m.useState(null),{setCurrentProfile:h,setLoading:b,setError:x}=U(),y=async p=>{if(p.preventDefault(),!a.trim()){d("Username is required");return}c(!0),d(null),g(null),x(null),b(!0);try{console.log("[CreateProfile] Starting profile creation...");const N=await W();console.log("[CreateProfile] Core initialized");const w=await N.createProfile(a.trim(),r.trim()||void 0,n.trim()||void 0);console.log("[CreateProfile] Profile created with magnet URI:",w);const S=await N.getCurrentProfile();if(console.log("[CreateProfile] Retrieved profile:",S),S)h(S),g(`Profile created successfully! Magnet URI: ${w}`),t(""),s(""),o(""),console.log("[CreateProfile] Profile creation completed successfully");else throw new Error("Failed to retrieve created profile")}catch(N){console.error("[CreateProfile] Error creating profile:",N);const w=N instanceof Error?N.message:"Failed to create profile";d(w),x(w)}finally{c(!1),b(!1)}};return e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Create Your Profile"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Username *"}),e.jsx("input",{type:"text",id:"username",value:a,onChange:p=>t(p.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your username",disabled:i,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",id:"displayName",value:r,onChange:p=>s(p.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Your display name (optional)",disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bio"}),e.jsx("textarea",{id:"bio",value:n,onChange:p=>o(p.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Tell us about yourself (optional)",disabled:i})]}),l&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:l})}),u&&e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:e.jsx("p",{className:"text-green-700 dark:text-green-300 text-sm",children:u})}),e.jsx("button",{type:"submit",disabled:i||!a.trim(),className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:cursor-not-allowed",children:i?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating Profile..."]}):"Create Profile"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"🔐 What happens when you create a profile?"}),e.jsxs("ul",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"• A new Ed25519 cryptographic key pair is generated"}),e.jsx("li",{children:"• Your profile is signed with your private key"}),e.jsx("li",{children:"• A magnet URI is created for peer-to-peer sharing"}),e.jsx("li",{children:"• Your private keys stay in your browser (never uploaded)"})]})]})]})})}const Ue=({profilePicture:a,username:t="User",size:r="md",className:s="",showOnlineStatus:n=!1,isOnline:o=!1,alt:i})=>{const c={xs:"w-6 h-6",sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-24 h-24"},l={xs:"w-1.5 h-1.5 bottom-0 right-0",sm:"w-2 h-2 bottom-0 right-0",md:"w-3 h-3 bottom-0.5 right-0.5",lg:"w-4 h-4 bottom-1 right-1",xl:"w-6 h-6 bottom-1 right-1"},d=g=>g.split(" ").map(h=>h.charAt(0).toUpperCase()).slice(0,2).join(""),u=a?e.jsx("img",{src:E.base64ToDataUrl(a),alt:i||`${t}'s avatar`,className:`${c[r]} rounded-full object-cover ${s}`}):e.jsx("div",{className:`${c[r]} rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold ${s}`,title:t,children:e.jsx("span",{className:`${r==="xs"?"text-xs":r==="sm"?"text-sm":r==="md"?"text-base":r==="lg"?"text-lg":"text-xl"}`,children:d(t)})});return e.jsxs("div",{className:"relative inline-block",children:[u,n&&e.jsx("div",{className:`absolute ${l[r]} ${o?"bg-green-400":"bg-gray-400"} border-2 border-white dark:border-gray-800 rounded-full`})]})},Fe=({onClose:a,onSuccess:t})=>{const{currentProfile:r,updateProfilePicture:s}=U(),n=m.useRef(null),[o,i]=m.useState(!1),[c,l]=m.useState(!1),[d,u]=m.useState(null),[g,h]=m.useState(null),[b,x]=m.useState(""),[y,p]=m.useState(0),N=()=>{u(null),h(null),x(""),p(0),n.current&&(n.current.value="")},w=m.useCallback(async k=>{const F=k[0];if(F)try{l(!0),x("📤 Processing image..."),p(25);const _=await E.processProfilePicture(F);p(75),await E.createThumbnail(_),p(90),h(_),u(_.dataUrl),x(`✅ Image processed successfully! Size: ${E.formatFileSize(_.size)}`),p(100),console.log("Image processed:",{originalSize:F.size,processedSize:_.size,dimensions:`${_.width}x${_.height}`,format:_.format})}catch(_){console.error("Image processing error:",_),x(`❌ Error: ${_ instanceof Error?_.message:"Unknown error"}`),N()}finally{l(!1)}},[]),S=k=>{const F=k.target.files;F&&F.length>0&&w(F)},H=m.useCallback(k=>{k.preventDefault(),k.stopPropagation(),i(!1),k.dataTransfer.files&&k.dataTransfer.files.length>0&&w(k.dataTransfer.files)},[w]),v=m.useCallback(k=>{k.preventDefault(),k.stopPropagation(),k.type==="dragenter"||k.type==="dragover"?i(!0):k.type==="dragleave"&&i(!1)},[]),D=async()=>{if(!g||!r){x("❌ No image to save or no current profile");return}try{l(!0),x("💾 Saving profile picture...");const k=await E.blobToBase64(g.blob),F=await E.createThumbnail(g),_=await E.blobToBase64(F.blob);s(r.username,k,_),x("✅ Profile picture saved successfully!"),t&&t(g.dataUrl),setTimeout(()=>{a&&a()},1500)}catch(k){console.error("Save error:",k),x(`❌ Failed to save: ${k instanceof Error?k.message:"Unknown error"}`)}finally{l(!1)}},L=()=>{r&&confirm("Remove your profile picture?")&&(s(r.username,"",""),localStorage.removeItem(`profile-picture-${r.username}`),localStorage.removeItem(`profile-picture-thumb-${r.username}`),x("✅ Profile picture removed"),t&&t(""),setTimeout(()=>{a&&a()},1e3))},ce=()=>y>=100?"w-full":y>=90?"w-11/12":y>=75?"w-3/4":y>=50?"w-1/2":y>=25?"w-1/4":"w-0";return e.jsxs("div",{className:"max-w-md mx-auto p-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Profile Picture"}),a&&e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"✕"})]}),!d&&e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${o?"border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:H,children:[e.jsx("div",{className:"text-4xl mb-4",children:"📷"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Drag and drop an image here, or click to select"}),e.jsx("button",{onClick:()=>n.current?.click(),disabled:c,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:"Choose Image"}),e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:S,className:"hidden","aria-label":"Select profile picture file",title:"Select profile picture file"}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"Supported: JPEG, PNG, WebP"}),e.jsx("p",{children:"Max size: 2MB • Auto-cropped to square"})]})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d,alt:"Profile preview",className:"w-32 h-32 rounded-full object-cover border-4 border-gray-200 dark:border-gray-600"}),c&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})})]})}),g&&e.jsxs("div",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:["Size: ",E.formatFileSize(g.size)]}),e.jsxs("p",{children:["Dimensions: ",g.width,"×",g.height,"px"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:D,disabled:c||!g,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:c?"💾 Saving...":"💾 Save"}),e.jsx("button",{onClick:N,disabled:c,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:"🔄 Try Again"})]})]}),c&&y>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`bg-blue-600 h-2 rounded-full transition-all duration-300 ${ce()}`})})}),r?.profilePicture&&!d&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{src:E.base64ToDataUrl(r.profilePicture),alt:"Current profile",className:"w-16 h-16 rounded-full object-cover border-2 border-gray-200 dark:border-gray-600"})}),e.jsx("button",{onClick:L,className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"🗑️ Remove Current Picture"})]}),b&&e.jsx("div",{className:`mt-4 p-3 rounded-lg text-sm ${b.startsWith("✅")?"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200":b.startsWith("❌")?"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200":"bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200"}`,children:b})]})},Re=()=>{const{currentProfile:a,addProfilePost:t,removeProfilePost:r}=U(),[s,n]=m.useState(""),[o,i]=m.useState(!1);if(!a)return null;const c=async l=>{l.preventDefault(),s.trim()&&(i(!0),t(a.username,s.trim()),n(""),i(!1))};return e.jsxs("div",{className:"w-full max-w-xl mx-auto mt-8",children:[e.jsxs("form",{onSubmit:c,className:"mb-6 flex flex-col gap-2",children:[e.jsx("textarea",{className:"w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-vertical",rows:3,placeholder:"What's on your mind?",value:s,onChange:l=>n(l.target.value),disabled:o}),e.jsx("button",{type:"submit",className:"self-end px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:bg-gray-400",disabled:o||!s.trim(),children:o?"Posting...":"Post"})]}),e.jsx("div",{className:"space-y-4",children:a.posts&&a.posts.length>0?a.posts.map(l=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 relative",children:[e.jsx("p",{className:"text-gray-900 dark:text-gray-100 mb-2 whitespace-pre-line",children:l.content}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 flex justify-between items-center",children:[e.jsx("span",{children:new Date(l.createdAt).toLocaleString()}),e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xs ml-2",onClick:()=>r(a.username,l.id),title:"Delete post",children:"🗑️"})]})]},l.id)):e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"No posts yet."})})]})},De=()=>{const{currentProfile:a}=U(),[t,r]=m.useState(!1);return a?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 flex flex-col items-center",children:[e.jsxs("div",{className:"mb-4 relative",children:[e.jsx(Ue,{profilePicture:a.profilePicture,username:a.username,size:"xl"}),e.jsx("button",{className:"absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-2 shadow-lg border-2 border-white dark:border-gray-800",onClick:()=>r(!0),title:"Change profile picture",children:e.jsx("span",{role:"img","aria-label":"Edit",children:"✏️"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:a.displayName||a.username}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-300 mb-2",children:["@",a.username]}),a.bio&&e.jsx("p",{className:"text-gray-700 dark:text-gray-200 mb-2 max-w-xl mx-auto",children:a.bio})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-4 relative w-full max-w-lg",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:()=>r(!1),title:"Close",children:"✕"}),e.jsx(Fe,{onClose:()=>r(!1)})]})}),e.jsx("div",{className:"w-full mt-8",children:e.jsx(Re,{})})]}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 text-center",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"No profile loaded."})})};function Me({progress:a,className:t=""}){const r=Math.max(0,Math.min(100,a*100)),s=()=>r===0?"w-0":r>=100?"w-full":r>=75?"w-3/4":r>=50?"w-1/2":r>=25?"w-1/4":"w-1/12";return e.jsx("div",{className:`w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 overflow-hidden ${t}`,children:e.jsx("div",{className:`bg-blue-600 h-2 rounded-full transition-all duration-300 ${s()}`})})}function Le(){const[a,t]=m.useState({torrents:0,downloadSpeed:0,uploadSpeed:0,downloaded:0,uploaded:0,peers:0}),[r,s]=m.useState([]),[n,o]=m.useState([]),[i,c]=m.useState(!1);m.useEffect(()=>{let d;const g=(()=>{try{const h=M();c(!0);const b=h.onEvent(x=>{const y=new Date().toLocaleTimeString();switch(x.type){case"seeding-started":"profile"in x&&x.profile?o(p=>[`[${y}] ✅ Started seeding profile: ${x.profile.username}`,...p.slice(0,9)]):"post"in x&&x.post&&o(p=>[`[${y}] ✅ Started seeding post by: ${x.post.authorDisplayName||"anonymous"}`,...p.slice(0,9)]);break;case"peer-connected":o(p=>[`[${y}] 🔗 Peer connected: ${x.peerId}`,...p.slice(0,9)]);break;case"upload-progress":Math.random()<.1&&o(p=>[`[${y}] ⬆️ Upload: ${l(x.uploadSpeed)}/s`,...p.slice(0,9)]);break;case"profile-downloaded":x.profile&&o(p=>[`[${y}] ⬇️ Downloaded profile: ${x.profile.username}`,...p.slice(0,9)]);break;case"download-progress":Math.random()<.1&&o(p=>[`[${y}] ⬇️ Progress: ${(x.progress*100).toFixed(1)}%`,...p.slice(0,9)]);break;case"error":o(p=>[`[${y}] ❌ Error: ${x.error}`,...p.slice(0,9)]);break}});return d=setInterval(()=>{t(h.getStats()),s(h.getActiveTorrents())},2e3),t(h.getStats()),s(h.getActiveTorrents()),b}catch(h){console.error("Failed to initialize torrent service:",h),c(!1),o(b=>[`Failed to initialize WebTorrent: ${h}`,...b.slice(0,9)])}})();return()=>{d&&clearInterval(d),g&&g()}},[]);const l=d=>{if(d===0)return"0 B";const u=1024,g=["B","KB","MB","GB"],h=Math.floor(Math.log(d)/Math.log(u));return parseFloat((d/Math.pow(u,h)).toFixed(1))+" "+g[h]};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"WebTorrent Client"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:i?"Connected":"Disconnected"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a.torrents}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Torrents"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:a.peers}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Connected Peers"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[e.jsxs("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:["⬆️ ",l(a.uploadSpeed),"/s"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Upload Speed"})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsxs("div",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:["⬇️ ",l(a.downloadSpeed),"/s"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Download Speed"})]}),e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:l(a.uploaded)}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Uploaded"})]}),e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-lg font-bold text-pink-600 dark:text-pink-400",children:l(a.downloaded)}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Downloaded"})]})]}),r.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Active Torrents"}),e.jsx("div",{className:"space-y-2",children:r.map(d=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:d.name||"Unnamed Torrent"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[(d.progress*100).toFixed(1),"%"]})]}),e.jsx(Me,{progress:d.progress,className:"mb-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Peers: ",d.numPeers]}),e.jsxs("span",{children:["⬆️ ",l(d.uploadSpeed),"/s ⬇️ ",l(d.downloadSpeed),"/s"]})]})]},d.infoHash))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Recent Activity"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-48 overflow-y-auto",children:n.length>0?e.jsx("div",{className:"space-y-1",children:n.map((d,u)=>e.jsx("div",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:d},u))}):e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-16",children:"No activity yet. Start seeding a profile to see torrent activity!"})})]})]})}class ee{static BACKUP_VERSION="1.0.0";static FILE_EXTENSION=".snartnet-backup";static async createBackup(t=!0){try{const s=await(await W()).getCurrentProfile();if(!s)throw new Error("No current profile to backup");const n=localStorage.getItem("snartnet_keypair");if(!n)throw new Error("No keypair found for backup");const o=localStorage.getItem(`profile-extended-${s.username}`);let i=null;if(t){const l=localStorage.getItem("snartnet-contacts");i=l?JSON.parse(l):[]}const c={version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),profile:s,keypair:JSON.parse(n),extendedData:o?JSON.parse(o):null,contacts:i,metadata:{username:s.username,fingerprint:s.fingerprint||"unknown",backupId:this.generateBackupId()}};return console.log("Backup created successfully:",{username:c.metadata.username,timestamp:c.timestamp,includesContacts:!!c.contacts}),c}catch(r){throw console.error("Failed to create backup:",r),new Error(`Backup creation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}static async downloadBackup(t=!0,r){try{const s=await this.createBackup(t);let n=s;r&&(n=await this.encryptBackup(s,r));const o=JSON.stringify(n,null,2),i=new Blob([o],{type:"application/json"}),c=URL.createObjectURL(i),l=document.createElement("a");l.href=c,l.download=`${s.metadata.username}_backup_${this.formatDateForFilename(s.timestamp)}${this.FILE_EXTENSION}`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),console.log("Backup downloaded successfully")}catch(s){throw console.error("Failed to download backup:",s),s}}static async restoreFromBackup(t,r){try{let s;r&&t.encrypted?s=await this.decryptBackup(t,r):s=t,this.validateBackup(s),console.log("Restoring backup:",{version:s.version,username:s.metadata.username,timestamp:s.timestamp}),localStorage.removeItem("snartnet_keypair"),localStorage.removeItem("snartnet_current_profile"),localStorage.removeItem("snartnet-contacts"),localStorage.setItem("snartnet_keypair",JSON.stringify(s.keypair)),localStorage.setItem("snartnet_current_profile",JSON.stringify({profile:s.profile,signature:s.keypair?.signature||"restored"})),s.extendedData&&s.metadata.username&&localStorage.setItem(`profile-extended-${s.metadata.username}`,JSON.stringify(s.extendedData)),s.contacts&&localStorage.setItem("snartnet-contacts",JSON.stringify(s.contacts)),console.log("Backup restored successfully"),window.location.reload()}catch(s){throw console.error("Failed to restore backup:",s),new Error(`Restore failed: ${s instanceof Error?s.message:"Unknown error"}`)}}static async restoreFromFile(t,r){try{if(!t.name.endsWith(this.FILE_EXTENSION)&&!t.name.endsWith(".json"))throw new Error("Invalid backup file format. Please select a .snartnet-backup or .json file.");const s=await this.readFileContent(t),n=JSON.parse(s);await this.restoreFromBackup(n,r)}catch(s){throw console.error("Failed to restore from file:",s),s}}static async encryptBackup(t,r){const s=JSON.stringify(t),n=btoa(unescape(encodeURIComponent(s)));return{encrypted:!0,version:t.version,data:n,hint:`Backup for ${t.metadata.username}`,timestamp:t.timestamp}}static async decryptBackup(t,r){try{const s=decodeURIComponent(escape(atob(t.data)));return JSON.parse(s)}catch{throw new Error("Invalid password or corrupted backup file")}}static validateBackup(t){if(!t||typeof t!="object")throw new Error("Invalid backup format");if(!t.version||!t.timestamp||!t.profile||!t.keypair)throw new Error("Incomplete backup data");if(!t.metadata||!t.metadata.username)throw new Error("Missing backup metadata");t.version!==this.BACKUP_VERSION&&console.warn("Backup version mismatch:",t.version,"vs",this.BACKUP_VERSION)}static readFileContent(t){return new Promise((r,s)=>{const n=new FileReader;n.onload=o=>{o.target?.result?r(o.target.result):s(new Error("Failed to read file"))},n.onerror=()=>{s(new Error("File reading error"))},n.readAsText(t)})}static generateBackupId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static formatDateForFilename(t){return new Date(t).toISOString().split("T")[0].replace(/-/g,"")}static async getBackupInfo(t,r){try{const s=await this.readFileContent(t);let n=JSON.parse(s);return n.encrypted&&r&&(n=await this.decryptBackup(n,r)),{username:n.metadata?.username||"Unknown",timestamp:n.timestamp||"Unknown",version:n.version||"Unknown",hasContacts:Array.isArray(n.contacts)&&n.contacts.length>0,fingerprint:n.metadata?.fingerprint||"Unknown"}}catch(s){throw new Error("Failed to read backup info: "+(s instanceof Error?s.message:"Unknown error"))}}}const Oe=({onClose:a})=>{const{currentProfile:t}=U(),r=m.useRef(null),[s,n]=m.useState("backup"),[o,i]=m.useState(!0),[c,l]=m.useState(!1),[d,u]=m.useState(""),[g,h]=m.useState(!1),[b,x]=m.useState(""),[y,p]=m.useState(null),N=async()=>{if(!t){x("❌ No profile to backup");return}if(c&&!d.trim()){x("❌ Password is required");return}try{h(!0),x("📦 Creating backup..."),await ee.downloadBackup(o,c?d:void 0),x("✅ Backup downloaded successfully!")}catch(v){console.error("Backup failed:",v),x(`❌ Backup failed: ${v instanceof Error?v.message:"Unknown error"}`)}finally{h(!1)}},w=async v=>{const D=v.target.files?.[0];if(D)try{h(!0),x("📄 Reading backup file...");const L=await ee.getBackupInfo(D,c?d:void 0);p(L),x("📋 Backup file loaded. Review info below and click Restore.")}catch(L){console.error("Failed to read backup:",L),x(`❌ Failed to read backup: ${L instanceof Error?L.message:"Unknown error"}`),p(null)}finally{h(!1)}},S=async()=>{const v=r.current?.files?.[0];if(!v){x("❌ Please select a backup file");return}if(c&&!d.trim()){x("❌ Password is required");return}if(confirm("⚠️ This will replace your current profile and data. Are you sure?"))try{h(!0),x("🔄 Restoring backup..."),await ee.restoreFromFile(v,c?d:void 0),x("✅ Backup restored successfully! Page will reload...")}catch(D){console.error("Restore failed:",D),x(`❌ Restore failed: ${D instanceof Error?D.message:"Unknown error"}`)}finally{h(!1)}},H=()=>{u(""),x(""),p(null),r.current&&(r.current.value="")};return e.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Profile Backup & Restore"}),a&&e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"✕"})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>{n("backup"),H()},className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${s==="backup"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:"📦 Backup"}),e.jsx("button",{onClick:()=>{n("restore"),H()},className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${s==="restore"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:"🔄 Restore"})]})}),s==="backup"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"📋 What gets backed up:"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[e.jsx("li",{children:"• Your profile information and cryptographic keys"}),e.jsx("li",{children:"• Extended profile data (avatar, location, website)"}),e.jsx("li",{children:"• Your contacts and relationships (optional)"}),e.jsx("li",{children:"• All necessary data to restore your identity"})]})]}),t?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Current Profile:"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("strong",{children:"Username:"})," ",t.username,e.jsx("br",{}),e.jsx("strong",{children:"Display Name:"})," ",t.displayName||"Not set",e.jsx("br",{}),e.jsx("strong",{children:"Public Key:"})," ",t.publicKey?.slice(0,16)+"..."||"Unknown"]})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4",children:e.jsx("p",{className:"text-yellow-800 dark:text-yellow-200",children:"⚠️ No profile found to backup. Please create a profile first."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:v=>i(v.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Include contacts and relationships in backup"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:v=>l(v.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Password protect backup (recommended)"})]}),c&&e.jsx("input",{type:"password",value:d,onChange:v=>u(v.target.value),placeholder:"Enter backup password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsx("button",{onClick:N,disabled:g||!t,className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors",children:g?"📦 Creating Backup...":"💾 Download Backup"})]}),s==="restore"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-900 dark:text-yellow-100 mb-2",children:"⚠️ Important Warning:"}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Restoring a backup will completely replace your current profile, keys, and data. Make sure to backup your current profile first if you want to keep it."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Backup File:"}),e.jsx("input",{ref:r,type:"file",accept:".snartnet-backup,.json",onChange:w,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Accepts .snartnet-backup and .json files"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:v=>l(v.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Backup is password protected"})]}),c&&e.jsx("input",{type:"password",value:d,onChange:v=>u(v.target.value),placeholder:"Enter backup password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),y&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Backup Information:"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",y.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",new Date(y.timestamp).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Version:"})," ",y.version]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fingerprint:"})," ",y.fingerprint]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Includes Contacts:"})," ",y.hasContacts?"Yes":"No"]})]})]}),e.jsx("button",{onClick:S,disabled:g||!y,className:"w-full px-4 py-3 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors",children:g?"🔄 Restoring...":"🔄 Restore Backup"})]}),b&&e.jsx("div",{className:`mt-6 p-4 rounded-lg ${b.startsWith("✅")?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700":b.startsWith("❌")?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700":b.startsWith("⚠️")?"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700":"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700"}`,children:e.jsx("p",{className:`text-sm font-medium ${b.startsWith("✅")?"text-green-800 dark:text-green-200":b.startsWith("❌")?"text-red-800 dark:text-red-200":b.startsWith("⚠️")?"text-yellow-800 dark:text-yellow-200":"text-blue-800 dark:text-blue-200"}`,children:b})})]})},Be=()=>{const{currentProfile:a,loading:t}=U(),[r,s]=m.useState(!1),[n,o]=m.useState(!1);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Profile Management"}),e.jsx("div",{className:"flex gap-2",children:a&&!r&&!n&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors",children:"💾 Backup & Restore"}),e.jsx("button",{onClick:()=>s(!0),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors",children:"Create New Profile"})]})})]}),t&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading profile..."})]}),!t&&e.jsxs("div",{className:"space-y-8",children:[n&&e.jsx("div",{children:e.jsx(Oe,{onClose:()=>o(!1)})}),r&&!n&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Create New Profile"}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"✕ Cancel"})]}),e.jsx(ne,{})]}),!n&&e.jsxs(e.Fragment,{children:[a?e.jsx("div",{children:!r&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Current Profile"}),e.jsx(De,{})]})}):!r&&e.jsx(ne,{}),e.jsx(Le,{})]})]})]})},$e=()=>e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Messages"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Encrypted messaging features coming soon..."})})]});function le({onProfileDownloaded:a}){const{currentProfile:t}=U(),[r,s]=m.useState(""),[n,o]=m.useState(!1),[i,c]=m.useState(""),[l,d]=m.useState(""),[u,g]=m.useState(!1),[h,b]=m.useState(!1),x=async()=>{if(!t){c("No profile to seed");return}try{g(!0),c("Starting to seed your profile...");const S=await(await W()).seedCurrentProfile();d(S),c("✅ Profile is now seeding! Share the magnet link with friends."),b(!0)}catch(w){console.error("Error seeding profile:",w),c(`❌ Failed to seed profile: ${w}`)}finally{g(!1)}},y=async()=>{if(!r.trim()){c("Please enter a magnet link");return}if(!r.startsWith("magnet:?")){c("Invalid magnet link format");return}try{o(!0),c("Connecting to peers and downloading profile...");const S=await(await W()).downloadProfileFromMagnet(r.trim());S?(c(`✅ Successfully downloaded profile: ${S.username}`),s(""),a&&a(S)):c("❌ Failed to download profile - no data received")}catch(w){console.error("Error downloading profile:",w),c(`❌ Download failed: ${w}`)}finally{o(!1)}},p=async()=>{if(l)try{await navigator.clipboard.writeText(l),c("✅ Magnet link copied to clipboard!"),setTimeout(()=>c(""),3e3)}catch(w){console.error("Failed to copy magnet link:",w),c("Failed to copy magnet link")}},N=async()=>{if(l&&"share"in navigator)try{await navigator.share({title:`${t?.username}'s SnartNet Profile`,text:"Connect with me on SnartNet! Download my profile using this magnet link:",url:l})}catch(w){console.log("Share cancelled or failed:",w)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Connect with Friends"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Share Your Profile"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Start seeding your profile so friends can download it via P2P torrent network."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:x,disabled:!t||u,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors",children:u?"Starting Seed...":"🌱 Start Seeding Profile"}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"📋 Copy Magnet Link"}),"share"in navigator&&e.jsx("button",{onClick:N,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors",children:"📱 Share"})]})]}),l&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Your Magnet Link:"}),e.jsx("code",{className:"text-xs text-gray-600 dark:text-gray-400 break-all font-mono",children:l})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Download Friend's Profile"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Enter a magnet link from a friend to download their profile via P2P."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"magnet-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Magnet Link"}),e.jsx("textarea",{id:"magnet-input",value:r,onChange:w=>s(w.target.value),placeholder:"magnet:?xt=urn:btih:...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3})]}),e.jsx("button",{onClick:y,disabled:!r.trim()||n,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors",children:n?"⬇️ Downloading...":"⬇️ Download Profile"})]})]}),i&&e.jsx("div",{className:`p-4 rounded-lg ${i.includes("✅")?"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200":i.includes("❌")?"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200":"bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200"}`,children:e.jsx("p",{className:"text-sm font-medium",children:i})}),h&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"🎉 Profile Successfully Seeding!"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"✕"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Your profile is now available on the P2P network. Share this magnet link with friends:"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 mb-4",children:e.jsx("code",{className:"text-xs text-gray-600 dark:text-gray-400 break-all font-mono",children:l})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"📋 Copy"}),"share"in navigator&&e.jsx("button",{onClick:N,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors",children:"📱 Share"})]})]})})]})}function ze(){const[a,t]=m.useState([]),{addContact:r,getContact:s}=ae();m.useEffect(()=>{const l=localStorage.getItem("snartnet-discovered-profiles");if(l)try{t(JSON.parse(l))}catch(d){console.error("Failed to load discovered profiles:",d)}},[]),m.useEffect(()=>{localStorage.setItem("snartnet-discovered-profiles",JSON.stringify(a))},[a]);const n=l=>{const d=a.findIndex(g=>g.publicKey===l.publicKey),u={id:l.publicKey.slice(0,8),username:l.username,displayName:l.displayName||l.username,bio:l.bio,publicKey:l.publicKey,avatar:l.avatar,downloadedAt:new Date().toISOString(),magnetURI:l.magnetURI};if(d>=0){const g=[...a];g[d]={...g[d],...u},t(g)}else t(g=>[u,...g])},o=l=>{t(d=>d.filter(u=>u.publicKey!==l))},i=(l,d="friend")=>{const u=`contact_${btoa(l.username+(l.magnetURI||"")).slice(0,16)}`;if(s(u)){alert(`${l.username} is already in your contacts!`);return}r({username:l.username,displayName:l.displayName,relationship:d,trustLevel:d==="friend"?7:5,magnetUri:l.magnetURI||"",avatar:l.avatar,notes:`Added from discovery on ${new Date().toLocaleDateString()}`}),alert(`${l.username} has been added to your ${d}s!`)},c=l=>new Date(l).toLocaleDateString()+" "+new Date(l).toLocaleTimeString();return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Discover Friends"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Share your profile and download friends' profiles using magnet links."})]}),e.jsx(le,{onProfileDownloaded:n}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Downloaded Friends (",a.length,")"]})}),a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"👥"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No friends discovered yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Use the magnet link manager above to download friends' profiles from the P2P network."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:a.map(l=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:border-blue-300 dark:hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[l.avatar?e.jsx("img",{src:l.avatar,alt:`${l.username}'s avatar`,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:l.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:l.displayName}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["@",l.username]})]})]}),e.jsx("button",{onClick:()=>o(l.publicKey),className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 p-1",title:"Remove profile",children:"🗑️"})]}),l.bio&&e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-3 line-clamp-2",children:l.bio}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[e.jsxs("p",{children:["Downloaded: ",c(l.downloadedAt)]}),e.jsxs("p",{className:"font-mono",children:["ID: ",l.id]})]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{onClick:()=>i(l,"friend"),className:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors",children:"➕ Add Friend"}),e.jsx("button",{onClick:()=>i(l,"acquaintance"),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:"🤝 Add Acquaintance"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-medium rounded-lg transition-colors",children:"💬 Message"}),e.jsx("button",{className:"flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-medium rounded-lg transition-colors",children:"👤 View Profile"})]})]},l.publicKey))})]})]})}const We=()=>{const{loadContacts:a,addContact:t,removeContact:r,updateContact:s,getContactsByRelationship:n}=ae(),[o,i]=m.useState("friend"),[c,l]=m.useState(!1);m.useEffect(()=>{a()},[a]);const d=[{id:"friend",label:"Friends",icon:"👥"},{id:"acquaintance",label:"Acquaintances",icon:"🤝"},{id:"ring-of-trust",label:"Ring of Trust",icon:"🛡️"},{id:"group-member",label:"Groups",icon:"🏠"}],u=n(o);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{className:"mb-10",children:e.jsx(le,{})}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Contacts & Relationships"}),e.jsx("button",{onClick:()=>l(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Add Contact"})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsx("nav",{className:"flex space-x-8",children:d.map(g=>e.jsxs("button",{onClick:()=>i(g.id),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${o===g.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:g.icon}),g.label,e.jsx("span",{className:"ml-2 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-full px-2 py-1 text-xs",children:n(g.id).length})]},g.id))})}),c&&e.jsx(Je,{onAdd:t,onCancel:()=>l(!1),defaultRelationship:o}),e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsx(qe,{relationship:o,onAddContact:()=>l(!0)}):u.map(g=>e.jsx(Ke,{contact:g,onUpdate:s,onRemove:r},g.id))})]})},Je=({onAdd:a,onCancel:t,defaultRelationship:r})=>{const[s,n]=m.useState({username:"",displayName:"",relationship:r,trustLevel:5,magnetUri:"",notes:""}),o=i=>{i.preventDefault(),!(!s.username||!s.magnetUri)&&(a({username:s.username,displayName:s.displayName||s.username,relationship:s.relationship,trustLevel:s.trustLevel,magnetUri:s.magnetUri,notes:s.notes}),t())};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New Contact"}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:s.username,onChange:i=>n(c=>({...c,username:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0,placeholder:"Enter username",title:"Username"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",value:s.displayName,onChange:i=>n(c=>({...c,displayName:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Enter display name (optional)",title:"Display Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Relationship Type"}),e.jsxs("select",{value:s.relationship,onChange:i=>n(c=>({...c,relationship:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",title:"Relationship Type",children:[e.jsx("option",{value:"friend",children:"Friend"}),e.jsx("option",{value:"acquaintance",children:"Acquaintance"}),e.jsx("option",{value:"ring-of-trust",children:"Ring of Trust"}),e.jsx("option",{value:"group-member",children:"Group Member"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trust Level (1-10)"}),e.jsx("input",{type:"range",min:"1",max:"10",value:s.trustLevel,onChange:i=>n(c=>({...c,trustLevel:parseInt(i.target.value)})),className:"w-full",title:"Trust Level",placeholder:"Trust Level"}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:s.trustLevel})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Magnet URI *"}),e.jsx("input",{type:"text",value:s.magnetUri,onChange:i=>n(c=>({...c,magnetUri:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"magnet:?xt=urn:btih:...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes"}),e.jsx("textarea",{value:s.notes,onChange:i=>n(c=>({...c,notes:i.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Optional notes about this contact..."})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"Add Contact"}),e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-md",children:"Cancel"})]})]})]})},Ke=({contact:a,onRemove:t})=>{const[r,s]=m.useState(!1),n=()=>{s(!r)},o=c=>{switch(c){case"ring-of-trust":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"friend":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"acquaintance":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"group-member":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"}},i=c=>new Date(c).toLocaleDateString();return e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center",children:a.avatar?e.jsx("img",{src:a.avatar,alt:a.displayName,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("span",{className:"text-lg font-semibold text-gray-600 dark:text-gray-300",children:a.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:a.displayName}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",a.username]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o(a.relationship)}`,children:a.relationship.replace("-"," ")}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Trust: ",a.trustLevel,"/10"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:n,className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded",children:"Edit"}),e.jsx("button",{onClick:()=>t(a.id),className:"px-3 py-1 text-sm bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-700 dark:text-red-300 rounded",children:"Remove"})]})]}),a.notes&&e.jsx("div",{className:"mt-3 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm text-gray-600 dark:text-gray-400",children:a.notes}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:["Added: ",i(a.addedDate),a.lastSeen&&` • Last seen: ${i(a.lastSeen)}`]})]})},qe=({relationship:a,onAddContact:t})=>{const r=s=>{switch(s){case"friend":return"No friends added yet. Start building your network!";case"acquaintance":return"No acquaintances yet. Add casual connections here.";case"ring-of-trust":return"No trusted contacts yet. Add your most trusted contacts for key recovery.";case"group-member":return"No group members yet. Add contacts from your groups."}};return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📱"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:r(a)}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Add contacts to start building your decentralized social network."}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Add First Contact"})]})},Ve=()=>e.jsx("nav",{className:"bg-white dark:bg-gray-800 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx(z,{to:"/",className:"text-xl font-bold text-gray-900 dark:text-white",children:"SnartNet"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(z,{to:"/",className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Home"}),e.jsx(z,{to:"/profile",className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Profile"}),e.jsx(z,{to:"/discover",className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Discover"}),e.jsx(z,{to:"/contacts",className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Contacts"}),e.jsx(z,{to:"/messages",className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Messages"})]})]})})}),He=({children:a})=>e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(Ve,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:a})]});function Ye(){const{setCurrentProfile:a,setLoading:t,setError:r}=U();m.useEffect(()=>{let s=!0;return(async()=>{try{t(!0),r(null),console.log("[useInitializeCore] Initializing core...");const o=await W();if(console.log("[useInitializeCore] Core initialized successfully"),console.log("[useInitializeCore] Initializing torrent service..."),M(),console.log("[useInitializeCore] Torrent service initialized."),o.hasProfile()){console.log("[useInitializeCore] Found existing profile, loading...");const i=await o.getCurrentProfile();i&&s&&(console.log("[useInitializeCore] Loaded existing profile:",i),a(i))}else console.log("[useInitializeCore] No existing profile found")}catch(o){if(console.error("[useInitializeCore] Failed to initialize core:",o),s){const i=o instanceof Error?o.message:"Failed to initialize";r(i)}}finally{s&&t(!1)}})(),()=>{s=!1}},[a,t,r])}function Ge(){return Ye(),e.jsx(de,{basename:"/net",children:e.jsx(He,{children:e.jsxs(ge,{children:[e.jsx(J,{path:"/",element:e.jsx(Ae,{})}),e.jsx(J,{path:"/profile/:id?",element:e.jsx(Be,{})}),e.jsx(J,{path:"/discover",element:e.jsx(ze,{})}),e.jsx(J,{path:"/contacts",element:e.jsx(We,{})}),e.jsx(J,{path:"/messages/:id?",element:e.jsx($e,{})})]})})})}ue(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(Ge,{})}));
//# sourceMappingURL=index-BJVKqDZ6.js.map
